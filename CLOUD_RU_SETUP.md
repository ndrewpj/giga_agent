# Пошаговая инструкция  для установки и настройки Giga Agent на виртуальной машине в Cloud.ru.

Видео-версия инструкции по разворачиванию GigaAgent на cloud.ru [YouTube](https://youtu.be/tyeXgCJ090Y?si=WcbITF3DiTo_aBUF), [RuTube](https://rutube.ru/video/c9a416a654723f0b1df23424bd3d9b4d/).

### Шаг 0: Создание SSH-ключа (если у вас его нет)

SSH-ключ — это безопасный способ подключения к вашему серверу без пароля. Он состоит из двух частей: приватного ключа (остается на вашем компьютере) и публичного ключа (загружается на сервер).

#### Для macOS и Linux:

1.  Откройте терминал.
2.  Выполните команду для генерации ключа. Рекомендуется использовать надежный алгоритм и достаточную длину:
    ```bash
    ssh-keygen -t rsa -b 4096
    ```
3.  Система предложит вам указать путь для сохранения ключа. Просто нажмите **Enter**, чтобы использовать путь по умолчанию (`~/.ssh/id_rsa`).
4.  Далее вам будет предложено ввести кодовую фразу (passphrase). Это дополнительный пароль для защиты вашего ключа. Для простоты вы можете оставить его пустым, нажав **Enter** дважды.
5.  Ваш ключ создан. Теперь скопируйте содержимое **публичного** ключа. Для этого выведите его в терминал командой:
    ```bash
    cat ~/.ssh/id_rsa.pub
    ```
    Скопируйте всю выведенную строку, начиная с `ssh-rsa` и заканчивая вашим email или именем хоста. Этот ключ понадобится на следующем шаге.

#### Для Windows 10/11:

Современные версии Windows включают клиент OpenSSH, и вы можете использовать ту же команду, что и для Linux.

1.  Откройте **PowerShell** или **Командную строку**.
2.  Выполните команду:
    ```bash
    ssh-keygen -t rsa -b 4096
    ```
3.  Следуйте тем же инструкциям, что и для macOS/Linux: нажмите **Enter** для выбора пути по умолчанию (обычно `C:\Users\ВашеИмя\.ssh\id_rsa`) и решите, хотите ли вы использовать кодовую фразу.
4.  Выведите содержимое публичного ключа командой:
    ```bash
    cat C:\Users\ВашеИмя\.ssh\id_rsa.pub
    ```
    Замените `ВашеИмя` на ваше имя пользователя в системе. Скопируйте полученный ключ.

### Шаг 1: Вход в аккаунт и создание ВМ

1.  Перейдите на сайт **cloud.ru** и нажмите **"Войти"**.
2.  Авторизуйтесь удобным для вас способом (например, Сбер ID).
3.  В панели управления нажмите **"Создать ресурс"** и выберите **"Виртуальная машина"**.
4.  Пролистайте страницу вниз и выберите опцию **"Получить ВМ бесплатно"**.
5.  В разделе **"Авторизация пользователя"** выберите метод аутентификации **"Публичный ключ"**.
6.  Нажмите **"Добавить новый ключ"**, вставьте ваш публичный ключ SSH, который вы создали и скопировали на **Шаге 0**, и сохраните его.
7.  Нажмите кнопку **"Создать"** и дождитесь, пока статус виртуальной машины станет "Запущена".

### Шаг 2: Подключение к ВМ и установка Giga Agent

1.  Скопируйте **публичный IP-адрес** вашей новой виртуальной машины из интерфейса Cloud.ru.
2.  Откройте терминал (или PowerShell) и подключитесь к серверу. Замените `public_ip` на IP-адрес вашей ВМ.

    ```bash
    ssh user1@public_ip
    ```
    *Если вы не использовали путь по умолчанию для ключа, укажите его с флагом `-i`: `ssh -i path/to/private_key user1@public_ip`*
3.  После подключения скачайте репозиторий Giga Agent с GitHub:

    ```bash
    git clone https://github.com/ai-forever/giga_agent.git
    ```
4.  Перейдите в созданную директорию:

    ```bash
    cd giga_agent/
    ```

### Шаг 3: Установка зависимостей (Docker, Python-pip)

1.  Установите менеджер пакетов `pip` для Python:

    ```bash
    sudo apt install python3-pip
    ```
2.  Обновите список пакетов системы:
    
    ```bash
    sudo apt update
    ```
3.  Установите пакеты для работы с репозиториями по HTTPS:
    
    ```bash
    sudo apt install apt-transport-https ca-certificates curl software-properties-common -y
    ```
4.  Добавьте официальный GPG-ключ Docker:
    
    ```bash
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    ```
5.  Добавьте репозиторий Docker в систему:
    
    ```bash
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```
6.  Снова обновите список пакетов:
    
    ```bash
    sudo apt update
    ```
7.  Установите Docker Engine, CLI, Containerd и Docker Compose:
    
    ```bash
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y
    ```

### Шаг 4: Настройка прав и виртуального окружения

1.  Добавьте вашего пользователя в группу `docker`, чтобы не использовать `sudo` для каждой команды Docker:
    
    ```bash
    sudo usermod -aG docker $USER
    ```
2.  Примените новые групповые права (для этого может потребоваться перезайти на сервер или выполнить команду ниже):
    
    ```bash
    newgrp docker
    ```
3.  Создайте виртуальное окружение Python:
    
    ```bash
    python3 -m venv venv
    ```
4.  Активируйте его:
    
    ```bash
    source venv/bin/activate
    ```
5.  Установите `langgraph` и `langgraph-cli`:
    
    ```bash
    pip install langgraph langgraph-cli
    ```

### Шаг 5: Конфигурация и запуск агента

1.  Создайте необходимые файлы конфигурации с помощью `make`:
    
    ```bash
    make init_files
    ```
2.  **В новом окне терминала на вашем локальном компьютере** скопируйте заранее подготовленный файл `.docker.env` с вашими ключами API на сервер:
    
    ```bash
    scp /local/path/to/.docker.env user1@public_ip:~/giga_agent/.docker.env
    ```
3.  Вернитесь в терминал с подключением к ВМ. Соберите граф проекта:
    
    ```bash
    make build_graph
    ```
4.  Запустите все сервисы агента с помощью Docker Compose:
   
    ```bash
    docker compose up -d
    ```

### Шаг 6: Настройка сетевого доступа

1.  Вернитесь в веб-интерфейс Cloud.ru.
2.  Перейдите в настройки вашей ВМ -> **Сетевые параметры** -> **Группы безопасности**.
3.  Выберите группу, привязанную к вашей ВМ, и перейдите на вкладку **"Правила"**.
4.  Добавьте новое **правило для входящего трафика** со следующими параметрами:
    *   **Протокол:** `TCP`
    *   **Порт:** `8502`
    *   **Источник:** `0.0.0.0/0` (для доступа из любой сети)
5.  Сохраните правило.

Теперь Giga Agent должен быть доступен в вашем браузере по адресу `http://<ваш_публичный_IP>:8502`.
